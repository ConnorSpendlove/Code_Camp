<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>MochiTheFox</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap">
    <link rel="stylesheet" href="styles/global_styles.css" />
    <link rel="stylesheet" href="styles/chatbot.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
</head>
<body>

  <!-- Navbar Component -->
  <div id="navbar"></div>

  <!-- Page Header -->
  <header style="text-align: center; margin-top: 20px;">
    <h1>Chat with Mochi</h1>
  </header>

  <!-- Main Content -->
   <div class="main-layout">
    <div id="chat" class="game-window">
        <div id="messages" class="message-board"></div> 

        <div class="input-area">
            <input id="input" placeholder="Ask Mochi..." class="text-input">
            <button id="send" class="arcade-button">SEND</button>
        </div>

        <div class="disclaimer-message"> 
            ⚠️ Mochi is not a certified therapist, so don't fully follow his advice.
        </div>
    </div>
   
    <div id="pet-container" class="pet-container chatbot-pet">
        </div>
</div>

  <!-- Footer Component -->
  <div id="footer"></div>

  <!-- Scripts -->
  <script src="components.js"></script>
  <script> 
       const messagesDiv = document.getElementById("messages");
    const input = document.getElementById("input");

    function addMessage(text, cls) {
      const div = document.createElement("div");
      div.className = "msg " + cls;
      div.textContent = text;
      messagesDiv.appendChild(div);
    }


//     * @param {string} text - The text you want the browser to speak.
     /*
    function speak(text) {
      // Create a new speech "utterance"
      const utterance = new SpeechSynthesisUtterance(text);
      
  
      
      // Tell the browser to speak it!
      window.speechSynthesis.speak(utterance);
    } */
    document.getElementById("send").addEventListener("click", async () => {
      const text = input.value.trim();
      if (!text) return;

      addMessage("You: " + text, "user");
      input.value = "";
  
      // Use "http://localhost:3000/chat" for local testing
      try {
        const res = await fetch("/api/chat", { //Use /api/chat for live deployment
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text })

        });
       /* console.log("Response status:", res.status);
        console.log("Response headers:", res);
        console.log("What it looks like: ", res.json());*/
        const data = await res.json();
        addMessage("Mochi: " + data.reply, "bot");

        /* Instead of checking for audio, just speak the reply!
        if (data.reply) {
          speak(data.reply);
        }*/


      } catch (err) {
        console.error("Error fetching chat:", err);
        addMessage("Pet: (I'm having trouble connecting...)", "bot");
      }
    });
  </script>
</body>
</html>
